# TensorFlow ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„í¬íŠ¸ (ë”¥ëŸ¬ë‹ í”„ë ˆì„ì›Œí¬)
import tensorflow as tf

# ì•ì—ì„œ ì •ì˜í•œ ë‹¤ì¸µ í¼ì…‰íŠ¸ë¡ (MLP) í´ë˜ìŠ¤ ì„í¬íŠ¸
from MLP import MLP

# ==========================================================
# ğŸ” XOR ë¬¸ì œ í•´ê²°ìš© ì‹¤í–‰ í•¨ìˆ˜
# - MLPë¥¼ ì´ìš©í•´ ë¹„ì„ í˜• ë…¼ë¦¬ ë¬¸ì œ(XOR)ë¥¼ í•™ìŠµ/ì˜ˆì¸¡í•¨
# ==========================================================
def xor_classifier_example():
    # ------------------------------------------
    # 1. XOR ì…ë ¥ ë°ì´í„° ì •ì˜
    # - ì´ 4ê°€ì§€ ì¡°í•©: [0,0], [0,1], [1,0], [1,1]
    # ------------------------------------------
    input_data = tf.constant([
        [0.0, 0.0],  # 0 XOR 0 = 0
        [0.0, 1.0],  # 0 XOR 1 = 1
        [1.0, 0.0],  # 1 XOR 0 = 1
        [1.0, 1.0]   # 1 XOR 1 = 0
    ])
    input_data = tf.cast(input_data, tf.float32)  # float32 íƒ€ì…ìœ¼ë¡œ ëª…ì‹œ ë³€í™˜

    # ------------------------------------------
    # 2. XOR ì •ë‹µ ë¼ë²¨ ì •ì˜
    # - ê° ì…ë ¥ ì¡°í•©ì— ëŒ€í•œ XOR ê²°ê³¼ (ì •ë‹µê°’)
    # ------------------------------------------
    xor_labels = tf.constant([0.0, 1.0, 1.0, 0.0])  # ì •ë‹µ: [0, 1, 1, 0]
    xor_labels = tf.cast(xor_labels, tf.float32)   # float32ë¡œ ëª…ì‹œ ë³€í™˜

    # ------------------------------------------
    # 3. í•™ìŠµ íŒŒë¼ë¯¸í„° ì„¤ì •
    # - ë°°ì¹˜ í¬ê¸°: 1 â†’ SGD ìŠ¤íƒ€ì¼
    # - ì—í­ ìˆ˜: 1500ë²ˆ ë°˜ë³µ í•™ìŠµ
    # ------------------------------------------
    batch_size = 1
    epochs = 1500

    # ------------------------------------------
    # 4. MLP ëª¨ë¸ êµ¬ì„±
    # - ì€ë‹‰ì¸µ 1ê°œ (ë…¸ë“œ 4ê°œ), ì¶œë ¥ì¸µ 1ê°œ
    # - ì…ë ¥ì¸µì€ ìë™ìœ¼ë¡œ 2ê°œ ë…¸ë“œë¡œ ì„¤ì •ë¨ (input_shape=[2,])
    # ------------------------------------------
    mlp_classifier = MLP(hidden_layer_conf=[4], num_output_nodes=1)
    mlp_classifier.build_model()

    # âœ… êµ¬ì¡° ìš”ì•½:
    # ì…ë ¥ì¸µ (2) â†’ ì€ë‹‰ì¸µ (4, sigmoid) â†’ ì¶œë ¥ì¸µ (1, sigmoid)

    # ------------------------------------------
    # 5. í•™ìŠµ ìˆ˜í–‰
    # - ì…ë ¥ê³¼ ì •ë‹µì„ ê¸°ë°˜ìœ¼ë¡œ ì—í­ ìˆ˜ë§Œí¼ ë°˜ë³µ í•™ìŠµ
    # ------------------------------------------
    mlp_classifier.fit(
        x=input_data,
        y=xor_labels,
        batch_size=batch_size,
        epochs=epochs
    )

    # ------------------------------------------
    # 6. ì˜ˆì¸¡ ìˆ˜í–‰
    # - í•™ìŠµëœ MLP ëª¨ë¸ë¡œ XOR ê²°ê³¼ ì˜ˆì¸¡
    # ------------------------------------------
    prediction = mlp_classifier.predict(x=input_data, batch_size=batch_size)

    # ì…ë ¥ê³¼ ì˜ˆì¸¡ ê²°ê³¼ ë¬¶ê¸° (ì‹œê°ì ìœ¼ë¡œ ë³´ê¸° ì¢‹ê²Œ ì¶œë ¥)
    input_and_result = zip(input_data, prediction)

    # ------------------------------------------
    # 7. ì˜ˆì¸¡ ê²°ê³¼ ì¶œë ¥
    # - 0.5 ê¸°ì¤€ìœ¼ë¡œ ì´ì§„ ë¶„ë¥˜ íŒë‹¨ (sigmoid ì¶œë ¥ ì‚¬ìš©)
    # ------------------------------------------
    print("============= MLP XOR Classifier result ============")
    for x, y in input_and_result:
        if y > 0.5:
            # ì˜ˆì¸¡ í™•ë¥ ì´ 0.5 ì´ˆê³¼ â†’ 1ë¡œ íŒë‹¨
            print("%d XOR %d => %.2f => 1" % (x[0], x[1], y.item()))
        else:
            # ì˜ˆì¸¡ í™•ë¥ ì´ 0.5 ì´í•˜ â†’ 0ìœ¼ë¡œ íŒë‹¨
            print("%d XOR %d => %.2f => 0" % (x[0], x[1], y.item()))

# ==========================================================
# Entry Point: ìŠ¤í¬ë¦½íŠ¸ê°€ ì§ì ‘ ì‹¤í–‰ë  ë•Œë§Œ í•¨ìˆ˜ í˜¸ì¶œ
# ==========================================================
if __name__ == '__main__':
    xor_classifier_example()
