# ================================
# ğŸ“¦ í•™ìŠµ ìŠ¤í¬ë¦½íŠ¸ (AutoEncoder í•™ìŠµìš©)
# ================================

# MNIST ë°ì´í„°ì…‹ì„ ë¡œë”©í•˜ê³  ì „ì²˜ë¦¬í•˜ëŠ” ì‚¬ìš©ì ì •ì˜ í´ë˜ìŠ¤ ì„í¬íŠ¸
from MNISTData import MNISTData

# AutoEncoder ëª¨ë¸ í´ë˜ìŠ¤ ì„í¬íŠ¸
from AutoEncoder import AutoEncoder

# Pythonì˜ ë©”ì¸ ì‹¤í–‰ë¶€
# ğŸ‘‰ ì´ ì½”ë“œëŠ” íŒŒì¼ì„ ì§ì ‘ ì‹¤í–‰í•  ë•Œë§Œ ì•„ë˜ ë¸”ë¡ì´ ì‹¤í–‰ë¨
if __name__ == "__main__":
    # ì‹¤í–‰ ì•ˆë‚´ ë©”ì‹œì§€
    print("Hi, I am an Auto Encoder Trainer.")

    # --------------------------------------
    # ğŸ› ï¸ í•™ìŠµ ì„¤ì •: í•˜ì´í¼íŒŒë¼ë¯¸í„° ì •ì˜
    # --------------------------------------
    batch_size = 32    # í•™ìŠµ ì‹œ í•œ ë²ˆì— ì²˜ë¦¬í•  ë°ì´í„° ìˆ˜
    num_epochs = 5     # ì „ì²´ í•™ìŠµ ë°˜ë³µ íšŸìˆ˜

    # --------------------------------------
    # ğŸ“¥ ë°ì´í„°ì…‹ ë¡œë“œ
    # --------------------------------------
    data_loader = MNISTData()        # MNIST ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ê°ì²´ ìƒì„±
    data_loader.load_data()          # ë‚´ë¶€ì ìœ¼ë¡œ x_train, x_test ë“± ì¤€ë¹„ë¨

    # í•™ìŠµì— ì‚¬ìš©í•  ë°ì´í„° ë³€ìˆ˜ë¡œ ì¶”ì¶œ
    x_train = data_loader.x_train              # 28x28 â†’ 784ë¡œ ë²¡í„°í™”ëœ ì´ë¯¸ì§€ ë°ì´í„°
    input_output_dim = data_loader.in_out_dim  # ì…ë ¥/ì¶œë ¥ ì°¨ì› ìˆ˜ (784)

    # --------------------------------------
    # ğŸ§  AutoEncoder ëª¨ë¸ êµ¬ì„±
    # --------------------------------------
    auto_encoder = AutoEncoder()        # AutoEncoder í´ë˜ìŠ¤ ê°ì²´ ìƒì„±
    auto_encoder.build_model()          # ì¸ì½”ë” + ë””ì½”ë” êµ¬ì¡° ì„¤ê³„ ë° ì»´íŒŒì¼

    # --------------------------------------
    # ğŸ” ëª¨ë¸ í•™ìŠµ
    # --------------------------------------
    # ì˜¤í† ì¸ì½”ë”ëŠ” ì…ë ¥ = ì¶œë ¥ êµ¬ì¡°ë¡œ í•™ìŠµë¨ (ë³µì› í•™ìŠµ)
    auto_encoder.fit(
        x=x_train,                     # ì…ë ¥ ë°ì´í„°
        y=x_train,                     # ì¶œë ¥ ë°ì´í„° (ì…ë ¥ê³¼ ë™ì¼)
        batch_size=batch_size,
        epochs=num_epochs
    )

    # --------------------------------------
    # ğŸ’¾ í•™ìŠµëœ ëª¨ë¸ ê°€ì¤‘ì¹˜ ì €ì¥
    # --------------------------------------
    save_path = "./model/ae_model.weights.h5"   # ì €ì¥ íŒŒì¼ ê²½ë¡œ ì§€ì •
    auto_encoder.save_weights(save_path)        # ëª¨ë¸ ê°€ì¤‘ì¹˜ ì €ì¥

    # ì €ì¥ ì™„ë£Œ ë©”ì‹œì§€ ì¶œë ¥
    print("load model weights from %s" % save_path)
